# 引き継ぎ資料
## ディレクトリ内容物
- Blender：3Dモデル，gltfファイル関連
- python：
  - 3Dモデルのヒトの位置を動かして，各位置におけるgltfファイルを新しく生成するプログラム
  - 送信電力を変更して，各送信電力におけるcsvファイルを新しく生成するプログラム
- room0419.m：レイトレースシミュレーションMATLABプログラム
- result
  - Rssi：レイトレースシミュレーションの結果
    - **ph_nr_15_15**：NRアンテナ（15，15）を用いた場合
    - **ph_nr_45_45**：NRアンテナ（45，45）を用いた場合
    - **detail**    
    時間分解能を小さくしたときのRssi（NRアンテナ（15，15）を用いた場合）
  - BER：Berの算出結果
    - **Ber_4.5**：人が4.5秒間移動した時のBER
      - 送信電力を変化
      - 材質に木とコンクリートを使用
      - 分割数を1〜100000まで変化
    - **Angle_between_antennas**：アンテナ間角度を変更した時のBER
      - 分割数は1000
      - 材質に木とコンクリートを使用
      - 送信電力を変化
    - **Antenna_Placement_Angle**：アンテナ配置角度を変更した時のBER
      - 分割数は1000
      - 材質に木とコンクリートを使用
      - 送信電力を変化
- glaf
  - **antenna**.m：アンテナの指向性の図を出力
  - **glaf_tx_power_change.m**：送信電力を変化させた時のBERのグラフ出力プログラム
  - **glaf_Angle_between_antennas.m**：アンテナ間角度を変化させた時のBERのグラフ出力プログラム
  - **glaf_Antenna_Placement_Angle.m**：アンテナ配置角度を変化させた時のBERのグラフ出力プログラム
  - **glaf_division_change.m**：分割数を変化させた時のBERのグラフ出力プログラム
  - **glaf_Ov.m**：Overheadのグラフ出力プログラム
  - **glaf_rssi_detail.m**：時間分解能を大きくした時の時間変化におけるRssiのグラフ出力プログラム
  - **glaf_rssi.m**：時間変化におけるRssiのグラフ出力プログラム
  - **glaf_TBer_detail.m**：時間分解能を大きくした時の時間変化におけるBerのグラフ出力プログラム
  - **glaf_TBer.m**：時間変化におけるBerのグラフ出力プログラム

## 以下詳細
## レイトレースシミュレーションプログラム
- raytrace/**room0419.m**
- 指定した環境でレイトレースシミュレーションが実施可能
  - 室内環境（gltfファイルで指定可能）
  - Tx：送信機周りの設定
  - Rx：受信機周りの設定
  - Propagation modelの設定
- レイトレースシミュレーションで算出した伝搬損失[dB]を受信電力[dBm]に変換
  - Matlabが提供している関数sigstrengthは材質ごとの受信電力算出が不可（2025/02/18）
  - 下記式で受信電力を算出  
  送信電力[dB] ＋送信機のアンテナ利得[dBi] ＋ 受信機のアンテナ利得[dBi] - 送信機のシステムロス[dB] - 受信機のシステムロス[dB] - 伝搬損失[dB]
- 人の移動位置ごとの受信電力を算出してcsvファイルに保存
    - 送信電力を変更する場合は**dbm_change.py**を使用
  - dbm_change.pyで変更したいファイル（材質，人の位置）のcsvファイルを指定して実行
  - -110dBmが測定限界
  
## 3D室内環境の作成に関して  
- Blenderで作成
    - ファイルの形式をgltfに変換
    - **0111_room_v04.gltf**として保存（付属のbinファイルやjpgファイルはレイトレース実行時に必要なので同じフォルダに保存）
- 3D室内環境の細部の変更を実施
    - 人の位置を変更 
      python/**file_exchange** 
      変更した位置ごとにgltfファイル生成を実施
- 材質の変更
    - materialsのnameにwood，concrete等の材質を追記することで指定可能
    - 下記にMatlabで使用できる材質を記載  
    MATLAB R2024b，“無線通信のためのレイトレーシング”． https://jp.mathworks.com/help/comm/ug/ray-tracing-for-wireless-communications.html 

## BER算出プログラム（matlab）  
- Berprogrumv02.mを実行  
- 実行時にレイトレースシミュレーションで出力した人の移動位置ごとの受信電力を記録したファイル(.csv)を使用
- 設定パラメータ（変更可）
    - 人の移動速度
    - 送信データサイズ
    - 送信速度
    - パイロット信号のbit数
    - 送信データの分割数
- 人が0.32m地点から3.92m地点まで移動するまで，送信データを送り続けたときのBER算出して保存
    - パイロット信号送信時の判定閾値を保存    
    保存先
    - Beam0の送信電力を10dBmに固定したとき    
      Ber/av/パイロット信号のbit数/材質/pv0_1/Beam1の水平方向におけるアンテナ方向/
    - Beam1の送信電力を10dBmに固定したとき    
      Ber/av/パイロット信号のbit数/材質/pv1_1/Beam1の水平方向におけるアンテナ方向/
    - 送信データを分割したときの1区間ずつのBERと人が移動し終えるまでの合計BERを保存
    保存先
    - Beam0の送信電力を10dBmに固定したとき    
      Ber/csv/パイロット信号のbit数/材質/pv0_1/Beam1の水平方向におけるアンテナ方向/
    - Beam1の送信電力を10dBmに固定したとき    
      Ber/csv/パイロット信号のbit数/材質/pv1_1/Beam1の水平方向におけるアンテナ方向/
